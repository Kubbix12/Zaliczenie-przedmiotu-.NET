<Window x:Class="CrudWpfApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:CrudWpfApp.ViewModels"
        mc:Ignorable="d"
        Title="Produkty" Height="560" Width="980"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Grid Margin="14">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="340"/>
            <ColumnDefinition Width="14"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Padding="14" CornerRadius="10" BorderBrush="#DDD" BorderThickness="1">
            <StackPanel>
                <TextBlock FontSize="18" FontWeight="SemiBold" Text="Formularz"/>

                <TextBlock Margin="0,2,0,12" Foreground="#666"
                           Text="Tryb dodawania produktu"
                           Visibility="{Binding IsAddMode, Converter={StaticResource BoolToVis}}"/>

                <TextBlock Margin="0,2,0,12" Foreground="#666"
                           Text="Tryb edytowania produktu"
                           Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}"/>

                <TextBlock Text="Nazwa" Margin="0,6,0,2"/>
                <TextBox
                    Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnValidationError=True}"
                    Margin="0,0,0,6"/>

                <TextBlock Text="Kategoria" Margin="0,6,0,2"/>
                <TextBox
                    Text="{Binding Category, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                    Margin="0,0,0,6"/>

                <TextBlock Text="Cena" Margin="0,6,0,2"/>
                <TextBox
                    Text="{Binding PriceText, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                    Margin="0,0,0,6"
                    PreviewTextInput="Price_PreviewTextInput"
                    DataObject.Pasting="Price_OnPaste"/>

                <TextBlock Text="Stan (szt.)" Margin="0,6,0,2"/>
                <TextBox
                    Text="{Binding StockText, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                    Margin="0,0,0,14"
                    PreviewTextInput="Stock_PreviewTextInput"
                    DataObject.Pasting="Stock_OnPaste"/>

                <WrapPanel>

                    <Button Content="Dodaj"
                            Command="{Binding AddCommand}"
                            Width="90" Height="34" Margin="0,0,8,8"
                            Visibility="{Binding IsAddMode, Converter={StaticResource BoolToVis}}"/>

                    <Button Content="Wyczyść"
                            Command="{Binding ClearCommand}"
                            Width="90" Height="34" Margin="0,0,8,8"
                            Visibility="{Binding IsAddMode, Converter={StaticResource BoolToVis}}"/>

                    <Button Content="Zapisz zmiany"
                            Command="{Binding UpdateCommand}"
                            Width="120" Height="34" Margin="0,0,8,8"
                            Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}"/>

                    <Button Content="Usuń"
                            Command="{Binding DeleteCommand}"
                            Width="90" Height="34" Margin="0,0,8,8"
                            Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}"/>

                    <Button Content="Przywróć wartości"
                            Command="{Binding RestoreCommand}"
                            Width="120" Height="34" Margin="0,0,8,8"
                            Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}"/>

                    <Button Content="Dodaj produkt"
                            Command="{Binding SwitchToAddModeCommand}"
                            Width="120" Height="34" Margin="0,0,8,8"
                            Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}"/>

                </WrapPanel>

                <TextBlock Margin="0,10,0,0"
                           Foreground="#666"
                           Text="Tip: kliknij w wiersz w tabeli po prawej, żeby wczytać dane do edycji."
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="10"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0">
                <TextBlock DockPanel.Dock="Left" FontSize="18" FontWeight="SemiBold" Text="Lista obiektów"/>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" Margin="0,0,8,0" Text="Szukaj:"/>
                    <TextBox Width="320"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
            </DockPanel>

            <DataGrid Grid.Row="2"
                      ItemsSource="{Binding ItemsView}"
                      SelectedItem="{Binding Selected}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      Margin="0">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Nazwa" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Kategoria" Binding="{Binding Category}" Width="220"/>
                    <DataGridTextColumn Header="Cena" Binding="{Binding Price}" Width="120"/>
                    <DataGridTextColumn Header="Stan" Binding="{Binding Stock}" Width="90"/>
                    <DataGridTextColumn Header="Utworzono" Binding="{Binding CreatedAt}" Width="180"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Window>
